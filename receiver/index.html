<!DOCTYPE html>
<html>
<head>
  <style type="text/css">
    body {
      overflow: hidden;
    }

    div {
      height: 720PX;
      width: 1280PX;
      text-align: center;
      border: 0px solid silver;
      display: table-cell;
      vertical-align: middle;
      color: #FFFFFF;
      background-color: #000000;
      font-weight: bold;
      font-family: Verdana, Geneva, sans-serif;
      font-size: 40px;
    }

    #screenshot {
      width: 100%;
      height: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 101;
    }
  </style>
  <title>TEA Casts</title>
</head>
<body>
<img id="screenshot" src=""/>
<div id="message">TEA Cast</div>
<script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
<script type="text/javascript">
  window.onload = function () {
    cast.receiver.logger.setLevelValue(0);
    window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
    console.log('Starting Receiver Manager');

    // handler for the 'ready' event
    castReceiverManager.onReady = function (event) {
      console.log('Received Ready event: ' + JSON.stringify(event.data));
      window.castReceiverManager.setApplicationState('Application status is ready...');
    };

    // handler for 'senderconnected' event
    castReceiverManager.onSenderConnected = function (event) {
      console.log('Received Sender Connected event: ' + event.data);
    };

    // handler for 'senderdisconnected' event
    castReceiverManager.onSenderDisconnected = function (event) {
      console.log('Received Sender Disconnected event: ' + event.data);
      if (window.castReceiverManager.getSenders().length === 0) {
        window.close();
      }
    };

    // create a CastMessageBus to handle messages for a custom namespace
    window.messageBus = window.castReceiverManager.getCastMessageBus('urn:x-cast:com.tea.cast.monitoring');

    // handler for the CastMessageBus message event
    window.messageBus.onMessage = function (event) {
      console.log('Message [' + event.senderId + ']: ' + event.data);

      const message = JSON.parse(event.data);

      // display the message from the sender
      if (message.text) {
        displayText(message.text);
      }
      if (message.url) {
        loadUrl(message.url);
      }
      if (message.image) {
        loadImage(message.image);
      }
    };
    // initialize the CastReceiverManager with an application status message
    window.castReceiverManager.start({ statusText: 'Application is starting', maxInactivity: 3600 });
    console.log('Receiver Manager started');
  };

  // utility function to display the text message in the input field
  function displayText(text) {
    console.log(text);
    document.getElementById('message').innerText = text;
    window.castReceiverManager.setApplicationState(text);
  }

  function loadUrl(url) {
    document.getElementById('dashboard').setAttribute('src', url);
    window.castReceiverManager.setApplicationState(url);
  }

  function loadImage(url) {
    document.getElementById('screenshot').setAttribute('src', `${url}?v=${Date.now()}`);
    window.castReceiverManager.setApplicationState(url);
  }
</script>
</body>
</html>
